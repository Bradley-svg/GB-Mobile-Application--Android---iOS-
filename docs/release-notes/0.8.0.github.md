# 0.8.0 – Secure alerts, QR lookup, and push-driven diagnostics

## Highlights
- Auth hardening: login rate limits with IP/username lockouts, password reset flow, and TOTP 2FA setup/confirm/disable with login challenges (twoFactorSetupRequired + `/auth/login/2fa`).
- Device experience: dashboard gauges, compressor history card with vendor range caps/disabled handling, and combined alert/work order timeline plus diagnostics cards wired to `/health-plus`.
- Safety/file + audit: antivirus scanning pipeline, signed URLs with TTL/HMAC, and audit events around file uploads, shares, push, QR, and 2FA actions.
- Push + navigation: Expo push for alerts/test payloads with navigation metadata, gated registration/test routes, and notification handling that deep-links into alerts/devices from foreground/background.
- QR/device lookup: Expo-based scanner with role gating and backend `/devices/lookup-by-code` enforcing org scope and audit logging.
- Observability: `/health-plus` exposes version `0.8.0`, DB/storage/AV latency, vendor disable flags, push readiness, and telemetry/history status.

## Deployment notes
- Env templates: see `backend/.env.example` and `docs/envs.md` for LOCAL_DEV/STAGING/PRODUCTION blocks. Populate DB URLs (no creds), `JWT_SECRET`, file storage roots/URLs/signing secret, AV target, control/MQTT/history URLs or disable flags, `EXPO_ACCESS_TOKEN`, `PUSH_NOTIFICATIONS_ENABLED_ROLES`, and 2FA flags (`AUTH_2FA_ENABLED`, `AUTH_2FA_ENFORCE_ROLES`).
- Push: backend requires a valid `EXPO_ACCESS_TOKEN`; `/me/push/test` is gated by roles and surfaces health in `/health-plus`. Mobile reads `EXPO_PUBLIC_API_URL` per `eas.json` profile.
- Versioning: backend `APP_VERSION=0.8.0` (surfaced on `/health-plus`); mobile Expo `version`/`versionCode`/`buildNumber` set to `0.8.0`/`8`.
- Staging bootstrap: `backend/scripts/bootstrap-staging.(ts|sh)` applies migrations/seeds; see `docs/deploy-staging.md` for step-by-step staging bring-up and smoke curl examples.

## Upgrade notes
- Migrations to ensure are applied: `000010_auth_sessions_and_password_resets.js`, `000013_auth_two_factor.js`, `000014_push_tokens.js`.
- Push tables (`push_tokens`, `auth_device_push_tokens`) and audit/logging need DB migrate before rolling new app builds.

## Known issues / limitations
- Password reset emails require an external provider; backend issues tokens only.
- Expo push delivery depends on configured `EXPO_ACCESS_TOKEN`; health-check pushes remain optional.
- Heat-pump history may be disabled in staging/CI; compressor history will show “unavailable” when vendor calls are off.
- Mobile e2e/Detox can be emulator-dependent; primary platform focus remains Android dev client. iOS coverage is limited for this release candidate.
