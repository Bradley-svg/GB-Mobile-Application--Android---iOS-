# Server
# Port the HTTP API listens on
PORT=4000
# Runtime environment (development/production/test)
NODE_ENV=development
# Comma-separated list of allowed origins (required in production)
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:19006

# Optional version string exposed on /health-plus
APP_VERSION=0.1.0-dev

# Logging
# Level used by structured logger (e.g. info, warn, error, debug)
LOG_LEVEL=info

# Database (local dev + tests)
# Postgres connection string (required for local dev)
DATABASE_URL=postgres://postgres:postgres@localhost:5432/greenbro_dev
# Connection string for integration tests (required for npm test)
TEST_DATABASE_URL=postgres://postgres:postgres@localhost:5432/greenbro_test
# Set to "true" to allow the test harness to truncate when the DB name is not obviously test-only
ALLOW_TEST_DB_RESET=true

# File storage (dev/local)
# Root path for uploaded files
FILE_STORAGE_ROOT=./storage
# Base URL for serving files (use the local API host)
FILE_STORAGE_BASE_URL=http://localhost:4000/files

# Auth
# Secret used to sign JWTs; use a long random string in production (required for local dev auth)
JWT_SECRET=replace-with-a-long-random-string
# Days before refresh tokens expire (default 30)
REFRESH_TOKEN_DAYS=30
# Allow public signup via /auth/signup (defaults to false)
AUTH_ALLOW_PUBLIC_SIGNUP=false
# User roles are stored on each user. Roles: owner/admin/facilities/contractor.
# Owner/Admin: full control, schedules, work orders, share links, uploads.
# Facilities: device control + work orders/uploads + share links (schedules may be restricted).
# Contractor: read-only; cannot upload or create share links.

# MQTT telemetry ingest (leave empty for local UI testing)
MQTT_URL=
MQTT_USERNAME=
MQTT_PASSWORD=

# Alerts worker thresholds
# Minutes offline before triggering an offline alert
ALERT_OFFLINE_MINUTES=10
# Minutes offline before upgrading an offline alert to critical
ALERT_OFFLINE_CRITICAL_MINUTES=60
# Temperature threshold that triggers a high-temp alert
ALERT_HIGH_TEMP_THRESHOLD=60
# Polling interval (seconds) for the alerts worker
ALERT_WORKER_INTERVAL_SEC=60
# Enable/disable the alerts worker (defaults to true)
ALERT_WORKER_ENABLED=true
# TTL (seconds) for DB-backed worker locks used by long-running workers
WORKER_LOCK_TTL_SEC=60

# Control/commands HTTP endpoint (optional; leave empty locally)
CONTROL_API_URL=
CONTROL_API_KEY=
# Minimum interval between repeated control commands to the same device (ms)
CONTROL_COMMAND_THROTTLE_MS=5000

# External heat pump history API (optional; leave empty locally)
HEATPUMP_HISTORY_URL=
HEATPUMP_HISTORY_API_KEY=
HEATPUMP_HISTORY_TIMEOUT_MS=10000
# Legacy HEAT_PUMP_* variants are still accepted as fallbacks but should be migrated.

# Expo push integration
# Access token for Expo push notifications (optional)
EXPO_ACCESS_TOKEN=
# Enable sending a small sample push on /health-plus (false by default)
PUSH_HEALTHCHECK_ENABLED=false
# Optional override token for health push (otherwise uses most recent token)
PUSH_HEALTHCHECK_TOKEN=
# Minutes between health-check push attempts
PUSH_HEALTHCHECK_INTERVAL_MINUTES=30
