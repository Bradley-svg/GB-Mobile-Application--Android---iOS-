# Server
# Port the HTTP API listens on
PORT=4000
# Runtime environment (development/production/test)
NODE_ENV=development
# Comma-separated list of allowed origins (required in production)
CORS_ALLOWED_ORIGINS=https://app.greenbro.co.za

# Optional version string exposed on /health-plus
APP_VERSION=0.1.0

# Logging
# Level used by structured logger (e.g. info, warn, error, debug)
LOG_LEVEL=info

# Database
# Postgres connection string
DATABASE_URL=postgres://USER:PASS@HOST:5432/greenbro_dev
# Connection string for integration tests (required for npm test)
TEST_DATABASE_URL=
# Set to "true" to allow the test harness to truncate when the DB name is not obviously test-only
# ALLOW_TEST_DB_RESET=false

# Auth
# Secret used to sign JWTs; use a long random string in production
JWT_SECRET=replace-with-a-long-random-string
# Days before refresh tokens expire (default 30)
REFRESH_TOKEN_DAYS=30
# Allow public signup via /auth/signup (defaults to false)
AUTH_ALLOW_PUBLIC_SIGNUP=false

# MQTT telemetry ingest
# MQTT broker URL for telemetry ingest
MQTT_URL=mqtt://broker-host:1883
# MQTT username for telemetry ingest
MQTT_USERNAME=your-mqtt-username
# MQTT password for telemetry ingest
MQTT_PASSWORD=your-mqtt-password

# Alerts worker thresholds
# Minutes offline before triggering an offline alert
ALERT_OFFLINE_MINUTES=10
# Minutes offline before upgrading an offline alert to critical
ALERT_OFFLINE_CRITICAL_MINUTES=60
# Temperature threshold that triggers a high-temp alert
ALERT_HIGH_TEMP_THRESHOLD=60
# Polling interval (seconds) for the alerts worker
ALERT_WORKER_INTERVAL_SEC=60
# Enable/disable the alerts worker (defaults to true)
ALERT_WORKER_ENABLED=true
# TTL (seconds) for DB-backed worker locks used by long-running workers
WORKER_LOCK_TTL_SEC=60

# Control/commands HTTP endpoint (optional)
# Base URL for control/commands provider
CONTROL_API_URL=https://partner-control-api.example.com
# API key for control/commands provider
CONTROL_API_KEY=replace-with-api-key

# External heat pump history API
HEATPUMP_HISTORY_URL=https://za-iot-dev-api.azurewebsites.net/api/HeatPumpHistory/historyHeatPump
HEATPUMP_HISTORY_API_KEY=
HEATPUMP_HISTORY_TIMEOUT_MS=10000
# Legacy HEAT_PUMP_* variants are still accepted as fallbacks but should be migrated.

# Expo push integration
# Access token for Expo push notifications (optional)
EXPO_ACCESS_TOKEN=replace-with-expo-access-token-or-leave-empty
# Enable sending a small sample push on /health-plus (false by default)
PUSH_HEALTHCHECK_ENABLED=false
# Optional override token for health push (otherwise uses most recent token)
PUSH_HEALTHCHECK_TOKEN=
# Minutes between health-check push attempts
PUSH_HEALTHCHECK_INTERVAL_MINUTES=30
