# Server
# Port the HTTP API listens on
PORT=4000
# Runtime environment (development/production/test)
NODE_ENV=development
# Comma-separated list of allowed origins (required in production)
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:19006

# Optional version string exposed on /health-plus
APP_VERSION=0.7.0

# Logging
# Level used by structured logger (e.g. info, warn, error, debug)
LOG_LEVEL=info
# Threshold (ms) for emitting slow-query warnings; set to 0 to disable
DB_SLOW_QUERY_MS=500

# Database (local dev + tests)
# Postgres connection string (required for local dev)
DATABASE_URL=postgres://postgres:postgres@localhost:5432/greenbro_dev
# Connection string for integration tests (required for npm test)
TEST_DATABASE_URL=postgres://postgres:postgres@localhost:5432/greenbro_test
# Set to "true" to allow the test harness to truncate when the DB name is not obviously test-only
ALLOW_TEST_DB_RESET=true
# Optional staging connection string used by scripts/bootstrap-staging.ts
STAGING_DATABASE_URL=

# File storage (dev/local)
# Root path for uploaded files (must be writable). Optional in dev; required in staging/prod.
FILE_STORAGE_ROOT=./storage
# Base URL for serving files (use API host locally; set to CDN/reverse-proxy origin in staging/prod).
FILE_STORAGE_BASE_URL=http://localhost:4000/files
# HMAC secret for issuing signed file URLs (`/files/:id/signed-url` -> `/files/signed/:token`).
# Optional in dev; required in staging/prod if signed URLs are enabled. Do not reuse the JWT secret.
FILE_SIGNING_SECRET=
# Default TTL (minutes) for signed file URLs when no ttlSeconds override is provided
FILE_SIGNED_URL_TTL_MINUTES=60
# Antivirus scanning (optional; disabled by default and always stubbed in tests)
AV_SCANNER_ENABLED=false
# One of: local command (e.g. clamscan wrapper) or clamd host/port target.
AV_SCANNER_CMD=clamscan --no-summary
# Optional clamd target; when both host and port are set, uploads are streamed to the daemon.
AV_SCANNER_HOST=
AV_SCANNER_PORT=

# Auth
# Secret used to sign JWTs; use a long random string in production (required for local dev auth)
JWT_SECRET=replace-with-a-long-random-string
# Days before refresh tokens expire (default 30)
REFRESH_TOKEN_DAYS=30
# Authentication rate limits (per IP and per username)
AUTH_MAX_ATTEMPTS=5
AUTH_WINDOW_MINUTES=15
AUTH_LOCKOUT_MINUTES=15
# Allow public signup via /auth/signup (defaults to false)
AUTH_ALLOW_PUBLIC_SIGNUP=false
# Minutes before a password reset token expires
PASSWORD_RESET_TOKEN_MINUTES=30
# Two-factor authentication (TOTP; optional)
AUTH_2FA_ENABLED=false
# Comma-separated roles required to use 2FA when enabled (e.g. owner,admin)
AUTH_2FA_ENFORCE_ROLES=owner,admin
# Issuer displayed in authenticator apps (e.g. Google Authenticator)
AUTH_2FA_ISSUER=Greenbro
# Optional: override the seeded demo user password for scripts/init-local-db.js
DEMO_USER_PASSWORD=
# User roles are stored on each user. Roles: owner/admin/facilities/contractor.
# Owner/Admin: full control, schedules, work orders, share links, uploads.
# Facilities: device control + work orders/uploads + share links (schedules may be restricted).
# Contractor: read-only; cannot upload or create share links.

# MQTT telemetry ingest (leave empty for local UI testing)
# Set MQTT_DISABLED=true to skip MQTT ingest (used by E2E/CI or offline testing).
MQTT_URL=
MQTT_USERNAME=
MQTT_PASSWORD=

# Alerts worker thresholds
# Minutes offline before triggering an offline alert
ALERT_OFFLINE_MINUTES=10
# Minutes offline before upgrading an offline alert to critical
ALERT_OFFLINE_CRITICAL_MINUTES=60
# Temperature threshold that triggers a high-temp alert
ALERT_HIGH_TEMP_THRESHOLD=60
# Minutes between alert rule refreshes (min 1 minute); used by alerts worker cache.
ALERT_RULE_REFRESH_MINUTES=5
# Polling interval (seconds) for the alerts worker
ALERT_WORKER_INTERVAL_SEC=60
# Enable/disable the alerts worker (defaults to true)
ALERT_WORKER_ENABLED=true
# TTL (seconds) for DB-backed worker locks used by long-running workers
WORKER_LOCK_TTL_SEC=60

# Control/commands HTTP endpoint (optional; leave empty locally)
# Set CONTROL_API_DISABLED=true to skip external control calls (used by E2E/CI).
CONTROL_API_URL=
CONTROL_API_KEY=
# Minimum interval between repeated control commands to the same device (ms)
CONTROL_COMMAND_THROTTLE_MS=5000

# External heat pump history API (optional; leave empty locally)
# Set HEATPUMP_HISTORY_DISABLED=true to skip vendor calls (used by E2E/CI).
HEATPUMP_HISTORY_URL=
HEATPUMP_HISTORY_API_KEY=
HEATPUMP_HISTORY_TIMEOUT_MS=10000
# Maximum hours per request window and optional paging size for large ranges
HEATPUMP_HISTORY_MAX_RANGE_HOURS=24
HEATPUMP_HISTORY_PAGE_HOURS=6
# Legacy HEAT_PUMP_* variants are still accepted as fallbacks but should be migrated.

# Expo push integration
# Access token for Expo push notifications (required to send push)
EXPO_ACCESS_TOKEN=
# Comma-separated roles that are eligible to receive push alerts
PUSH_NOTIFICATIONS_ENABLED_ROLES=owner,admin,facilities
# Enable sending a small sample push on /health-plus (false by default)
PUSH_HEALTHCHECK_ENABLED=false
# Optional override token for health push (otherwise uses most recent token)
PUSH_HEALTHCHECK_TOKEN=
# Minutes between health-check push attempts
PUSH_HEALTHCHECK_INTERVAL_MINUTES=30
# Set PUSH_NOTIFICATIONS_DISABLED=true to skip sending push in E2E/CI environments.
PUSH_NOTIFICATIONS_DISABLED=false
# Optional base URL for scripts/check-health.ts when probing deployed envs
HEALTH_BASE_URL=

##############################################
# STAGING TEMPLATE (placeholder values only; copy into staging secret store)
##############################################
# NODE_ENV=production
# APP_VERSION=0.7.0
# PORT=4000
# DATABASE_URL=postgres://<host>:5432/greenbro_staging
# CORS_ALLOWED_ORIGINS=https://staging.greenbro.co.za,https://staging-app.greenbro.co.za
# JWT_SECRET=replace-with-long-random-string
# REFRESH_TOKEN_DAYS=30
# AUTH_ALLOW_PUBLIC_SIGNUP=false
# AUTH_2FA_ENABLED=true
# AUTH_2FA_ENFORCE_ROLES=owner,admin
# FILE_STORAGE_ROOT=/var/lib/greenbro/storage
# FILE_STORAGE_BASE_URL=https://staging-api.greenbro.co.za/files
# FILE_SIGNING_SECRET=replace-with-long-random-string
# FILE_SIGNED_URL_TTL_MINUTES=60
# AV_SCANNER_ENABLED=true
# AV_SCANNER_HOST=clamd
# AV_SCANNER_PORT=3310
# MQTT_URL=mqtts://staging-broker:8883
# MQTT_USERNAME=
# MQTT_PASSWORD=
# MQTT_DISABLED=false
# CONTROL_API_URL=https://control.staging.greenbro.co.za
# CONTROL_API_KEY=<control-api-key>
# CONTROL_API_DISABLED=false
# CONTROL_COMMAND_THROTTLE_MS=5000
# HEATPUMP_HISTORY_URL=https://staging-heatpump.example
# HEATPUMP_HISTORY_API_KEY=<heatpump-api-key>
# HEATPUMP_HISTORY_TIMEOUT_MS=10000
# HEATPUMP_HISTORY_MAX_RANGE_HOURS=24
# HEATPUMP_HISTORY_PAGE_HOURS=6
# HEATPUMP_HISTORY_DISABLED=false
# EXPO_ACCESS_TOKEN=<staging-expo-token>
# PUSH_NOTIFICATIONS_ENABLED_ROLES=owner,admin,facilities
# PUSH_NOTIFICATIONS_DISABLED=false
# PUSH_HEALTHCHECK_ENABLED=false
# PUSH_HEALTHCHECK_TOKEN=
# PUSH_HEALTHCHECK_INTERVAL_MINUTES=30
# HEALTH_BASE_URL=https://staging-api.greenbro.co.za
# WORKER_LOCK_TTL_SEC=60
# DEMO_USER_PASSWORD=

##############################################
# PRODUCTION TEMPLATE (placeholder values only; copy into production secret store)
##############################################
# NODE_ENV=production
# APP_VERSION=0.7.0
# PORT=4000
# DATABASE_URL=postgres://<host>:5432/greenbro_prod
# CORS_ALLOWED_ORIGINS=https://app.greenbro.co.za,https://api.greenbro.co.za
# JWT_SECRET=replace-with-unique-production-secret
# REFRESH_TOKEN_DAYS=30
# AUTH_ALLOW_PUBLIC_SIGNUP=false
# AUTH_2FA_ENABLED=true
# AUTH_2FA_ENFORCE_ROLES=owner,admin
# FILE_STORAGE_ROOT=/var/lib/greenbro/storage
# FILE_STORAGE_BASE_URL=https://api.greenbro.co.za/files
# FILE_SIGNING_SECRET=replace-with-unique-prod-signing-secret
# FILE_SIGNED_URL_TTL_MINUTES=60
# AV_SCANNER_ENABLED=true
# AV_SCANNER_HOST=clamd
# AV_SCANNER_PORT=3310
# MQTT_URL=mqtts://mqtt.greenbro.co.za:8883
# MQTT_USERNAME=
# MQTT_PASSWORD=
# MQTT_DISABLED=false
# CONTROL_API_URL=https://control.greenbro.co.za
# CONTROL_API_KEY=<control-api-key>
# CONTROL_API_DISABLED=false
# CONTROL_COMMAND_THROTTLE_MS=5000
# HEATPUMP_HISTORY_URL=https://heatpump.greenbro.co.za
# HEATPUMP_HISTORY_API_KEY=<heatpump-api-key>
# HEATPUMP_HISTORY_TIMEOUT_MS=10000
# HEATPUMP_HISTORY_MAX_RANGE_HOURS=24
# HEATPUMP_HISTORY_PAGE_HOURS=6
# HEATPUMP_HISTORY_DISABLED=false
# EXPO_ACCESS_TOKEN=<production-expo-token>
# PUSH_NOTIFICATIONS_ENABLED_ROLES=owner,admin,facilities
# PUSH_NOTIFICATIONS_DISABLED=false
# PUSH_HEALTHCHECK_ENABLED=true
# PUSH_HEALTHCHECK_TOKEN=<push-health-token>
# PUSH_HEALTHCHECK_INTERVAL_MINUTES=30
# HEALTH_BASE_URL=https://api.greenbro.co.za
# WORKER_LOCK_TTL_SEC=60
# DEMO_USER_PASSWORD=
##############################################
# LOCAL DEVELOPMENT DEFAULTS
##############################################
