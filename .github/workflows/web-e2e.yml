name: Web E2E

on:
  workflow_dispatch:
    inputs:
      baseUrl:
        description: Base URL for the web app under test (e.g. seeded staging env)
        required: false
        type: string
      email:
        description: Login email (defaults to demo or secret)
        required: false
        type: string
      password:
        description: Login password (prefer repo/ORG secret WEB_E2E_PASSWORD)
        required: false
        type: string

jobs:
  smoke:
    runs-on: ubuntu-latest
    timeout-minutes: 25
    env:
      WEB_E2E_BASE_URL: ${{ inputs.baseUrl || secrets.WEB_E2E_BASE_URL || 'http://localhost:3000' }}
      WEB_E2E_EMAIL: ${{ inputs.email || secrets.WEB_E2E_EMAIL || 'demo@greenbro.com' }}
      WEB_E2E_PASSWORD: ${{ inputs.password || secrets.WEB_E2E_PASSWORD || 'password' }}
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
          cache-dependency-path: web/package-lock.json
      - run: npm ci --prefix web
      - run: npm exec --prefix web playwright install --with-deps
      - run: npm run web:e2e
